<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/963b888/css/bootstrap.css" rel="stylesheet">
<link href="./assets/e1ef68af/solarized_light.css" rel="stylesheet">
<link href="./assets/407eef69/style.css" rel="stylesheet">
<script src="./assets/5b23384c/jquery.js"></script>
<script src="./assets/963b888/js/bootstrap.js"></script>
<script src="./assets/538e96fb/jssearch.js"></script>    <title>Fixtures - Testing - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w1194" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w1194-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">The Definitive Guide to Yii 2.0</a></div><div id="w1194-collapse" class="collapse navbar-collapse"><ul id="w1195" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Extensions <span class="caret"></span></a><ul id="w1196" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-httpclient-index.html" tabindex="-1">httpclient</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-shell-index.html" tabindex="-1">shell</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-1178" data-toggle="collapse" data-parent="#navigation">Introduction <b class="caret"></b></a><div id="navigation-1178" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">About Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Upgrading from Version 1.1</a></div>
<a class="list-group-item" href="#navigation-1179" data-toggle="collapse" data-parent="#navigation">Getting Started <b class="caret"></b></a><div id="navigation-1179" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-prerequisites.html">What do you need to know</a>
<a class="list-group-item" href="./guide-start-installation.html">Installing Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Running Applications</a>
<a class="list-group-item" href="./guide-start-hello.html">Saying Hello</a>
<a class="list-group-item" href="./guide-start-forms.html">Working with Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">Working with Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">Generating Code with Gii</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Looking Ahead</a></div>
<a class="list-group-item" href="#navigation-1180" data-toggle="collapse" data-parent="#navigation">Application Structure <b class="caret"></b></a><div id="navigation-1180" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">Application Structure Overview</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Entry Scripts</a>
<a class="list-group-item" href="./guide-structure-applications.html">Applications</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Application Components</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Controllers</a>
<a class="list-group-item" href="./guide-structure-models.html">Models</a>
<a class="list-group-item" href="./guide-structure-views.html">Views</a>
<a class="list-group-item" href="./guide-structure-modules.html">Modules</a>
<a class="list-group-item" href="./guide-structure-filters.html">Filters</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Widgets</a>
<a class="list-group-item" href="./guide-structure-assets.html">Assets</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Extensions</a></div>
<a class="list-group-item" href="#navigation-1181" data-toggle="collapse" data-parent="#navigation">Handling Requests <b class="caret"></b></a><div id="navigation-1181" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Request Handling Overview</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Routing and URL Creation</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Requests</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Responses</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions and Cookies</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Handling Errors</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Logging</a></div>
<a class="list-group-item" href="#navigation-1182" data-toggle="collapse" data-parent="#navigation">Key Concepts <b class="caret"></b></a><div id="navigation-1182" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Components</a>
<a class="list-group-item" href="./guide-concept-properties.html">Properties</a>
<a class="list-group-item" href="./guide-concept-events.html">Events</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Behaviors</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Configurations</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Aliases</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Class Autoloading</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-1183" data-toggle="collapse" data-parent="#navigation">Working with Databases <b class="caret"></b></a><div id="navigation-1183" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Database Access Objects</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Query Builder</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Migrations</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-sphinx/doc/guide">Sphinx</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-redis/doc/guide">Redis</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-mongodb/doc/guide">MongoDB</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-elasticsearch/doc/guide">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-1184" data-toggle="collapse" data-parent="#navigation">Getting Data from Users <b class="caret"></b></a><div id="navigation-1184" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Creating Forms</a>
<a class="list-group-item" href="./guide-input-validation.html">Validating Input</a>
<a class="list-group-item" href="./guide-input-file-upload.html">Uploading Files</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Collecting Tabular Input</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Getting Data for Multiple Models</a>
<a class="list-group-item" href="./guide-input-form-javascript.html">Extending ActiveForm on the Client Side</a></div>
<a class="list-group-item" href="#navigation-1185" data-toggle="collapse" data-parent="#navigation">Displaying Data <b class="caret"></b></a><div id="navigation-1185" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">Data Formatting</a>
<a class="list-group-item" href="./guide-output-pagination.html">Pagination</a>
<a class="list-group-item" href="./guide-output-sorting.html">Sorting</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Data Providers</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Data Widgets</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">Working with Client Scripts</a>
<a class="list-group-item" href="./guide-output-theming.html">Theming</a></div>
<a class="list-group-item" href="#navigation-1186" data-toggle="collapse" data-parent="#navigation">Security <b class="caret"></b></a><div id="navigation-1186" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-overview.html">Security Overview</a>
<a class="list-group-item" href="./guide-security-authentication.html">Authentication</a>
<a class="list-group-item" href="./guide-security-authorization.html">Authorization</a>
<a class="list-group-item" href="./guide-security-passwords.html">Working with Passwords</a>
<a class="list-group-item" href="./guide-security-cryptography.html">Cryptography</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-authclient/doc/guide">Auth Clients</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Best Practices</a></div>
<a class="list-group-item" href="#navigation-1187" data-toggle="collapse" data-parent="#navigation">Caching <b class="caret"></b></a><div id="navigation-1187" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Caching Overview</a>
<a class="list-group-item" href="./guide-caching-data.html">Data Caching</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Fragment Caching</a>
<a class="list-group-item" href="./guide-caching-page.html">Page Caching</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP Caching</a></div>
<a class="list-group-item" href="#navigation-1188" data-toggle="collapse" data-parent="#navigation">RESTful Web Services <b class="caret"></b></a><div id="navigation-1188" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Quick Start</a>
<a class="list-group-item" href="./guide-rest-resources.html">Resources</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Controllers</a>
<a class="list-group-item" href="./guide-rest-routing.html">Routing</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Response Formatting</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Authentication</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Rate Limiting</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Versioning</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Error Handling</a></div>
<a class="list-group-item" href="#navigation-1189" data-toggle="collapse" data-parent="#navigation">Development Tools <b class="caret"></b></a><div id="navigation-1189" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-debug/doc/guide">Debug Toolbar and Debugger</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-gii/doc/guide">Generating Code using Gii</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-apidoc">Generating API Documentation</a></div>
<a class="list-group-item active" href="#navigation-1190" data-toggle="collapse" data-parent="#navigation">Testing <b class="caret"></b></a><div id="navigation-1190" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-test-overview.html">Testing Overview</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Testing environment setup</a>
<a class="list-group-item" href="./guide-test-unit.html">Unit Tests</a>
<a class="list-group-item" href="./guide-test-functional.html">Functional Tests</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Acceptance Tests</a>
<a class="list-group-item active" href="./guide-test-fixtures.html">Fixtures</a></div>
<a class="list-group-item" href="#navigation-1191" data-toggle="collapse" data-parent="#navigation">Special Topics <b class="caret"></b></a><div id="navigation-1191" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-app-advanced/doc/guide">Advanced Project Template</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Building Application from Scratch</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Console Commands</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Core Validators</a>
<a class="list-group-item" href="./guide-tutorial-docker.html">Docker</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Internationalization</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Mailing</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Performance Tuning</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Shared Hosting Environment</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Template Engines</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Working with Third-Party Code</a>
<a class="list-group-item" href="./guide-tutorial-yii-as-micro-framework.html">Using Yii as a micro framework</a></div>
<a class="list-group-item" href="#navigation-1192" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-1192" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-listview.html">ListView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-detailview.html">DetailView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/guide-input-forms.html#activerecord-based-forms-activeform">ActiveForm</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">Pjax</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-menu.html">Menu</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-linkpager.html">LinkPager</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-linksorter.html">LinkSorter</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-bootstrap/doc/guide">Bootstrap Widgets</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-jui/doc/guide">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-1193" data-toggle="collapse" data-parent="#navigation">Helpers <b class="caret"></b></a><div id="navigation-1193" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Helpers Overview</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Fixtures <span id="fixtures"></span><a href="#fixtures" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#defining-a-fixture">Defining a Fixture</a></li>
<li><a href="#using-fixtures">Using Fixtures</a></li>
<li><a href="#organizing-fixture-classes-and-data-files">Organizing Fixture Classes and Data Files</a></li>
<li><a href="#managing-fixtures-with-yii-fixture">Managing fixtures with yii fixture</a></li>
<li><a href="#summary">Summary</a></li></ol></div>
<p>Fixtures are an important part of testing. Their main purpose is to set up the environment in a fixed/known state
so that your tests are repeatable and run in an expected way. Yii provides a fixture framework that allows
you to define your fixtures precisely and use them easily both when running your tests with Codeception
and independently.</p>
<p>A key concept in the Yii fixture framework is the so-called <em>fixture object</em>. A fixture object represents
a particular aspect of a test environment and is an instance of <a href="./yii-test-fixture.html">yii\test\Fixture</a> or its child class. For example,
you may use <code>UserFixture</code> to make sure the user DB table contains a fixed set of data. You load one or multiple
fixture objects before running a test and unload them when finishing.</p>
<p>A fixture may depend on other fixtures, specified via its <a href="./yii-test-fixture.html#$depends-detail">yii\test\Fixture::$depends</a> property.
When a fixture is being loaded, the fixtures it depends on will be automatically loaded BEFORE the fixture;
and when the fixture is being unloaded, the dependent fixtures will be unloaded AFTER the fixture.</p>
<h2>Defining a Fixture <span id="defining-a-fixture"></span><a href="#defining-a-fixture" class="hashlink">&para;</a></h2><p>To define a fixture, create a new class by extending <a href="./yii-test-fixture.html">yii\test\Fixture</a> or <a href="./yii-test-activefixture.html">yii\test\ActiveFixture</a>.
The former is best suited for general purpose fixtures, while the latter has enhanced features specifically
designed to work with database and ActiveRecord.</p>
<p>The following code defines a fixture about the <code>User</code> ActiveRecord and the corresponding user table.</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">tests</span>\<span class="hljs-title">fixtures</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">test</span>\<span class="hljs-title">ActiveFixture</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserFixture</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActiveFixture</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$modelClass</span> = <span class="hljs-string">'app\models\User'</span>;
}
</code></pre>
<blockquote class="tip"><p><strong>Tip: </strong>Each <code>ActiveFixture</code> is about preparing a DB table for testing purpose. You may specify the table
by setting either the <a href="./yii-test-activefixture.html#$tableName-detail">yii\test\ActiveFixture::$tableName</a> property or the <a href="./yii-test-baseactivefixture.html#$modelClass-detail">yii\test\ActiveFixture::$modelClass</a>
property. If the latter, the table name will be taken from the <code>ActiveRecord</code> class specified by <code>modelClass</code>.</p>
</blockquote>
<blockquote class="note"><p><strong>Note: </strong><a href="./yii-test-activefixture.html">yii\test\ActiveFixture</a> is only suited for SQL databases. For NoSQL databases, Yii provides the following
<code>ActiveFixture</code> classes:</p>
<ul>
<li>Mongo DB: <a href="./yii-mongodb-activefixture.html">yii\mongodb\ActiveFixture</a></li>
<li>Elasticsearch: <a href="./yii-elasticsearch-activefixture.html">yii\elasticsearch\ActiveFixture</a> (since version 2.0.2)</li>
</ul>
</blockquote>
<p>The fixture data for an <code>ActiveFixture</code> fixture is usually provided in a file located at <code>FixturePath/data/TableName.php</code>,
where <code>FixturePath</code> stands for the directory containing the fixture class file, and <code>TableName</code>
is the name of the table associated with the fixture. In the example above, the file should be
<code>@app/tests/fixtures/data/user.php</code>. The data file should return an array of data rows
to be inserted into the user table. For example,</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">return</span> [
    <span class="hljs-string">'user1'</span> =&gt; [
        <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'lmayert'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'strosin.vernice@jerde.com'</span>,
        <span class="hljs-string">'auth_key'</span> =&gt; <span class="hljs-string">'K3nF70it7tzNsHddEiq0BZ0i-OU8S3xV'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$13$WSyE5hHsG1rWN2jV8LRHzubilrCLI5Ev/iK0r3jRuwQEs2ldRu.a2'</span>,
    ],
    <span class="hljs-string">'user2'</span> =&gt; [
        <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'napoleon69'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'aileen.barton@heaneyschumm.com'</span>,
        <span class="hljs-string">'auth_key'</span> =&gt; <span class="hljs-string">'dZlXsVnIDgIzFgX4EduAqkEPuphhOh9q'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$13$kkgpvJ8lnjKo8RuoR30ay.RjDf15bMcHIF7Vz1zz/6viYG5xJExU6'</span>,
    ],
];
</code></pre>
<p>You may give an alias to a row so that later in your test, you may refer to the row via the alias. In the above example,
the two rows are aliased as <code>user1</code> and <code>user2</code>, respectively.</p>
<p>Also, you do not need to specify the data for auto-incremental columns. Yii will automatically fill the actual
values into the rows when the fixture is being loaded.</p>
<blockquote class="tip"><p><strong>Tip: </strong>You may customize the location of the data file by setting the <a href="./yii-test-activefixture.html#$dataFile-detail">yii\test\ActiveFixture::$dataFile</a> property.
You may also override <a href="./yii-test-activefixture.html#getData()-detail">yii\test\ActiveFixture::getData()</a> to provide the data.</p>
</blockquote>
<p>As we described earlier, a fixture may depend on other fixtures. For example, a <code>UserProfileFixture</code> may need to depends on <code>UserFixture</code>
because the user profile table contains a foreign key pointing to the user table.
The dependency is specified via the <a href="./yii-test-fixture.html#$depends-detail">yii\test\Fixture::$depends</a> property, like the following,</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">tests</span>\<span class="hljs-title">fixtures</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">test</span>\<span class="hljs-title">ActiveFixture</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProfileFixture</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActiveFixture</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$modelClass</span> = <span class="hljs-string">'app\models\UserProfile'</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$depends</span> = [<span class="hljs-string">'app\tests\fixtures\UserFixture'</span>];
}
</code></pre>
<p>The dependency also ensures, that the fixtures are loaded and unloaded in a well defined order. In the above example <code>UserFixture</code> will
always be loaded before <code>UserProfileFixture</code> to ensure all foreign key references exist and will be unloaded after <code>UserProfileFixture</code>
has been unloaded for the same reason.</p>
<p>In the above, we have shown how to define a fixture about a DB table. To define a fixture not related with DB
(e.g. a fixture about certain files and directories), you may extend from the more general base class
<a href="./yii-test-fixture.html">yii\test\Fixture</a> and override the <a href="./yii-test-fixture.html#load()-detail">load()</a> and <a href="./yii-test-fixture.html#unload()-detail">unload()</a> methods.</p>
<h2>Using Fixtures <span id="using-fixtures"></span><a href="#using-fixtures" class="hashlink">&para;</a></h2><p>If you are using <a href="http://codeception.com/">Codeception</a> to test your code, you can use built-in support for loading
and accessing fixtures.</p>
<p>If you are using other testing frameworks, you may use <a href="./yii-test-fixturetrait.html">yii\test\FixtureTrait</a> in your
test cases to achieve the same goal.</p>
<p>In the following we will describe how to write a <code>UserProfile</code> unit test class using Codeception.</p>
<p>In your unit test class extending <code>\Codeception\Test\Unit</code> either declare fixtures you want to use in the
<code>_fixtures()</code> method or use <code>haveFixtures()</code> method of an actor directly. For example,</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">tests</span>\<span class="hljs-title">unit</span>\<span class="hljs-title">models</span>;


<span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">tests</span>\<span class="hljs-title">fixtures</span>\<span class="hljs-title">UserProfileFixture</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProfileTest</span> <span class="hljs-keyword">extends</span> \<span class="hljs-title">Codeception</span>\<span class="hljs-title">Test</span>\<span class="hljs-title">Unit</span>
</span>{   
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_fixtures</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'profiles'</span> =&gt; [
                <span class="hljs-string">'class'</span> =&gt; UserProfileFixture::className(),
                <span class="hljs-comment">// fixture data located in tests/_data/user.php</span>
                <span class="hljs-string">'dataFile'</span> =&gt; codecept_data_dir() . <span class="hljs-string">'user.php'</span>
            ],
        ];
    }

    <span class="hljs-comment">// ...test methods...</span>
}
</code></pre>
<p>The fixtures listed in the <code>_fixtures()</code> method will be automatically loaded before a test is executed. And as we
described before, when a fixture is being loaded, all its dependent fixtures will be automatically loaded first.
In the above example, because <code>UserProfileFixture</code> depends on <code>UserFixture</code>, when running any test method in the test
class, two fixtures will be loaded sequentially: <code>UserFixture</code> and <code>UserProfileFixture</code>.</p>
<p>When specifying fixtures for both <code>_fixtures()</code> and <code>haveFixtures()</code>, you may use either a class name
or a configuration array to refer to a fixture. The configuration array will let you customize
the fixture properties when the fixture is loaded.</p>
<p>You may also assign an alias to a fixture. In the above example, the <code>UserProfileFixture</code> is aliased as <code>profiles</code>.
In the test methods, you may then access a fixture object using its alias in <code>grabFixture()</code> method. For example,</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$profile</span> = <span class="hljs-variable">$I</span>-&gt;grabFixture(<span class="hljs-string">'profiles'</span>, <span class="hljs-string">'user1'</span>);
</code></pre>
<p>will return the <code>UserProfileFixture</code> object.</p>
<p>Because <code>UserProfileFixture</code> extends from <code>ActiveFixture</code>, you may further use the following syntax to access
the data provided by the fixture:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// returns the UserProfile model corresponding to the data row aliased as 'user1'</span>
<span class="hljs-variable">$profile</span> = <span class="hljs-variable">$I</span>-&gt;grabFixture(<span class="hljs-string">'profiles'</span>, <span class="hljs-string">'user1'</span>);
<span class="hljs-comment">// traverse data in the fixture</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$I</span>-&gt;grabFixture(<span class="hljs-string">'profiles'</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$profile</span>) ...
</code></pre>
<h2>Organizing Fixture Classes and Data Files <span id="organizing-fixture-classes-and-data-files"></span><a href="#organizing-fixture-classes-and-data-files" class="hashlink">&para;</a></h2><p>By default, fixture classes look for the corresponding data files under the <code>data</code> folder which is a sub-folder
of the folder containing the fixture class files. You can follow this convention when working with simple projects.
For big projects, chances are that you often need to switch different data files for the same fixture class for
different tests. We thus recommend that you organize the data files in a hierarchical way that is similar to
your class namespaces. For example,</p>
<pre><code class="hljs css"># <span class="hljs-tag">under</span> <span class="hljs-tag">folder</span> <span class="hljs-tag">tests</span>\<span class="hljs-tag">unit</span>\<span class="hljs-tag">fixtures</span>

<span class="hljs-tag">data</span>\
    <span class="hljs-tag">components</span>\
        <span class="hljs-tag">fixture_data_file1</span><span class="hljs-class">.php</span>
        <span class="hljs-tag">fixture_data_file2</span><span class="hljs-class">.php</span>
        ...
        <span class="hljs-tag">fixture_data_fileN</span><span class="hljs-class">.php</span>
    <span class="hljs-tag">models</span>\
        <span class="hljs-tag">fixture_data_file1</span><span class="hljs-class">.php</span>
        <span class="hljs-tag">fixture_data_file2</span><span class="hljs-class">.php</span>
        ...
        <span class="hljs-tag">fixture_data_fileN</span><span class="hljs-class">.php</span>
# <span class="hljs-tag">and</span> <span class="hljs-tag">so</span> <span class="hljs-tag">on</span>
</code></pre>
<p>In this way you will avoid collision of fixture data files between tests and use them as you need.</p>
<blockquote class="note"><p><strong>Note: </strong>In the example above fixture files are named only for example purpose. In real life you should name them
according to which fixture class your fixture classes are extending from. For example, if you are extending
from <a href="./yii-test-activefixture.html">yii\test\ActiveFixture</a> for DB fixtures, you should use DB table names as the fixture data file names;
If you are extending from <a href="./yii-mongodb-activefixture.html">yii\mongodb\ActiveFixture</a> for MongoDB fixtures, you should use collection names as the file names.</p>
</blockquote>
<p>The similar hierarchy can be used to organize fixture class files. Instead of using <code>data</code> as the root directory, you may
want to use <code>fixtures</code> as the root directory to avoid conflict with the data files.</p>
<h2>Managing fixtures with <code>yii fixture</code> <span id="managing-fixtures-with-yii-fixture"></span><a href="#managing-fixtures-with-yii-fixture" class="hashlink">&para;</a></h2><p>Yii supports fixtures via the <code>yii fixture</code> command line tool. This tool supports:</p>
<ul>
<li>Loading fixtures to different storage such as: RDBMS, NoSQL, etc;</li>
<li>Unloading fixtures in different ways (usually it is clearing storage);</li>
<li>Auto-generating fixtures and populating it with random data.</li>
</ul>
<h3>Fixtures data format <span id="fixtures-data-format"></span><a href="#fixtures-data-format" class="hashlink">&para;</a></h3><p>Lets assume we have fixtures data to load:</p>
<pre><code class="hljs php"><span class="hljs-comment">#users.php file under fixtures data path, by default @tests\unit\fixtures\data</span>

<span class="hljs-keyword">return</span> [
    [
        <span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'Chase'</span>,
        <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'lmayert'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'strosin.vernice@jerde.com'</span>,
        <span class="hljs-string">'auth_key'</span> =&gt; <span class="hljs-string">'K3nF70it7tzNsHddEiq0BZ0i-OU8S3xV'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$13$WSyE5hHsG1rWN2jV8LRHzubilrCLI5Ev/iK0r3jRuwQEs2ldRu.a2'</span>,
    ],
    [
        <span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'Celestine'</span>,
        <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'napoleon69'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'aileen.barton@heaneyschumm.com'</span>,
        <span class="hljs-string">'auth_key'</span> =&gt; <span class="hljs-string">'dZlXsVnIDgIzFgX4EduAqkEPuphhOh9q'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$13$kkgpvJ8lnjKo8RuoR30ay.RjDf15bMcHIF7Vz1zz/6viYG5xJExU6'</span>,
    ],
];
</code></pre>
<p>If we are using fixture that loads data into database then these rows will be applied to <code>users</code> table. If we are using nosql fixtures, for example <code>mongodb</code>
fixture, then this data will be applied to <code>users</code> mongodb collection. In order to learn about implementing various loading strategies and more, refer to official <a href="https://github.com/yiisoft/yii2/blob/master/docs/guide/test-fixtures.md">documentation</a>.
Above fixture example was auto-generated by <code>yii2-faker</code> extension, read more about it in these <a href="#auto-generating-fixtures">section</a>.
Fixture classes name should not be plural.</p>
<h3>Loading fixtures <span id="loading-fixtures"></span><a href="#loading-fixtures" class="hashlink">&para;</a></h3><p>Fixture classes should be suffixed by <code>Fixture</code> class. By default fixtures will be searched under <code>tests\unit\fixtures</code> namespace, you can
change this behavior with config or command options. You can exclude some fixtures due load or unload by specifying <code>-</code> before its name like <code>-User</code>.</p>
<p>To load fixture, run the following command:</p>
<blockquote class="note"><p><strong>Note: </strong>Prior to loading data unload sequence is executed. Usually that results in cleaning up all the existing data inserted by previous fixture executions.</p>
</blockquote>
<pre><code class="hljs nginx"><span class="hljs-title">yii</span> fixture/load &lt;fixture_name&gt;
</code></pre>
<p>The required <code>fixture_name</code> parameter specifies a fixture name which data will be loaded. You can load several fixtures at once.
Below are correct formats of this command:</p>
<pre><code class="hljs sql">// <span class="hljs-operator"><span class="hljs-keyword">load</span> <span class="hljs-string">`User`</span> fixture
yii fixture/<span class="hljs-keyword">load</span> <span class="hljs-keyword">User</span>

// same <span class="hljs-keyword">as</span> above, because <span class="hljs-keyword">default</span> <span class="hljs-keyword">action</span> <span class="hljs-keyword">of</span> <span class="hljs-string">"fixture"</span> command <span class="hljs-keyword">is</span> <span class="hljs-string">"load"</span>
yii fixture <span class="hljs-keyword">User</span>

// <span class="hljs-keyword">load</span> several fixtures
yii fixture <span class="hljs-string">"User, UserProfile"</span>

// <span class="hljs-keyword">load</span> all fixtures
yii fixture/<span class="hljs-keyword">load</span> <span class="hljs-string">"*"</span>

// same <span class="hljs-keyword">as</span> above
yii fixture <span class="hljs-string">"*"</span>

// <span class="hljs-keyword">load</span> all fixtures <span class="hljs-keyword">except</span> ones
yii fixture <span class="hljs-string">"*, -DoNotLoadThisOne"</span>

// <span class="hljs-keyword">load</span> fixtures, but <span class="hljs-keyword">search</span> them <span class="hljs-keyword">in</span> different namespace. <span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span> namespace <span class="hljs-keyword">is</span>: tests\unit\fixtures.
yii fixture <span class="hljs-keyword">User</span> <span class="hljs-comment">--namespace='alias\my\custom\namespace'</span>

// <span class="hljs-keyword">load</span> <span class="hljs-keyword">global</span> fixture <span class="hljs-string">`some\name\space\CustomFixture`</span> <span class="hljs-keyword">before</span> other fixtures will be loaded.
// <span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span> this <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> <span class="hljs-string">`InitDbFixture`</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span>/<span class="hljs-keyword">enable</span> integrity checks. You can specify several
// <span class="hljs-keyword">global</span> fixtures separated <span class="hljs-keyword">by</span> comma.
yii fixture <span class="hljs-keyword">User</span> <span class="hljs-comment">--globalFixtures='some\name\space\Custom'</span>
</span></code></pre>
<h3>Unloading fixtures <span id="unloading-fixtures"></span><a href="#unloading-fixtures" class="hashlink">&para;</a></h3><p>To unload fixture, run the following command:</p>
<pre><code class="hljs javascript"><span class="hljs-comment">// unload Users fixture, by default it will clear fixture storage (for example "users" table, or "users" collection if this is mongodb fixture).</span>
yii fixture/unload User

<span class="hljs-comment">// Unload several fixtures</span>
yii fixture/unload <span class="hljs-string">"User, UserProfile"</span>

<span class="hljs-comment">// unload all fixtures</span>
yii fixture/unload <span class="hljs-string">"*"</span>

<span class="hljs-comment">// unload all fixtures except ones</span>
yii fixture/unload <span class="hljs-string">"*, -DoNotUnloadThisOne"</span>

</code></pre>
<p>Same command options like: <code>namespace</code>, <code>globalFixtures</code> also can be applied to this command.</p>
<h3>Configure Command Globally <span id="configure-command-globally"></span><a href="#configure-command-globally" class="hashlink">&para;</a></h3><p>While command line options allow us to configure the fixture command
on-the-fly, sometimes we may want to configure the command once for all. For example you can configure
different fixture path as follows:</p>
<pre><code class="hljs php"><span class="hljs-string">'controllerMap'</span> =&gt; [
    <span class="hljs-string">'fixture'</span> =&gt; [
        <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\console\controllers\FixtureController'</span>,
        <span class="hljs-string">'namespace'</span> =&gt; <span class="hljs-string">'myalias\some\custom\namespace'</span>,
        <span class="hljs-string">'globalFixtures'</span> =&gt; [
            <span class="hljs-string">'some\name\space\Foo'</span>,
            <span class="hljs-string">'other\name\space\Bar'</span>
        ],
    ],
]
</code></pre>
<h3>Auto-generating fixtures <span id="auto-generating-fixtures"></span><a href="#auto-generating-fixtures" class="hashlink">&para;</a></h3><p>Yii also can auto-generate fixtures for you based on some template. You can generate your fixtures with different data on different languages and formats.
This feature is done by <a href="https://github.com/fzaninotto/Faker">Faker</a> library and <code>yii2-faker</code> extension.
See extension <a href="https://github.com/yiisoft/yii2-faker">guide</a> for more docs.</p>
<h2>Summary <span id="summary"></span><a href="#summary" class="hashlink">&para;</a></h2><p>In the above, we have described how to define and use fixtures. Below we summarize the typical workflow
of running unit tests related with DB:</p>
<ol>
<li>Use <code>yii migrate</code> tool to upgrade your test database to the latest version;</li>
<li>Run a test case:<ul>
<li>Load fixtures: clean up the relevant DB tables and populate them with fixture data;</li>
<li>Perform the actual test;</li>
<li>Unload fixtures.</li>
</ul>
</li>
<li>Repeat Step 2 until all tests finish.</li>
</ol>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Wed, 10 Apr 2019 23:20:40 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>

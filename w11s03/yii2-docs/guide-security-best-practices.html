<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/963b888/css/bootstrap.css" rel="stylesheet">
<link href="./assets/e1ef68af/solarized_light.css" rel="stylesheet">
<link href="./assets/407eef69/style.css" rel="stylesheet">
<script src="./assets/5b23384c/jquery.js"></script>
<script src="./assets/963b888/js/bootstrap.js"></script>
<script src="./assets/538e96fb/jssearch.js"></script>    <title>Best Practices - Security - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w567" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w567-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">The Definitive Guide to Yii 2.0</a></div><div id="w567-collapse" class="collapse navbar-collapse"><ul id="w568" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Extensions <span class="caret"></span></a><ul id="w569" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-httpclient-index.html" tabindex="-1">httpclient</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-shell-index.html" tabindex="-1">shell</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-551" data-toggle="collapse" data-parent="#navigation">Introduction <b class="caret"></b></a><div id="navigation-551" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">About Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Upgrading from Version 1.1</a></div>
<a class="list-group-item" href="#navigation-552" data-toggle="collapse" data-parent="#navigation">Getting Started <b class="caret"></b></a><div id="navigation-552" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-prerequisites.html">What do you need to know</a>
<a class="list-group-item" href="./guide-start-installation.html">Installing Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Running Applications</a>
<a class="list-group-item" href="./guide-start-hello.html">Saying Hello</a>
<a class="list-group-item" href="./guide-start-forms.html">Working with Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">Working with Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">Generating Code with Gii</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Looking Ahead</a></div>
<a class="list-group-item" href="#navigation-553" data-toggle="collapse" data-parent="#navigation">Application Structure <b class="caret"></b></a><div id="navigation-553" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">Application Structure Overview</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Entry Scripts</a>
<a class="list-group-item" href="./guide-structure-applications.html">Applications</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Application Components</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Controllers</a>
<a class="list-group-item" href="./guide-structure-models.html">Models</a>
<a class="list-group-item" href="./guide-structure-views.html">Views</a>
<a class="list-group-item" href="./guide-structure-modules.html">Modules</a>
<a class="list-group-item" href="./guide-structure-filters.html">Filters</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Widgets</a>
<a class="list-group-item" href="./guide-structure-assets.html">Assets</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Extensions</a></div>
<a class="list-group-item" href="#navigation-554" data-toggle="collapse" data-parent="#navigation">Handling Requests <b class="caret"></b></a><div id="navigation-554" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Request Handling Overview</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Routing and URL Creation</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Requests</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Responses</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions and Cookies</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Handling Errors</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Logging</a></div>
<a class="list-group-item" href="#navigation-555" data-toggle="collapse" data-parent="#navigation">Key Concepts <b class="caret"></b></a><div id="navigation-555" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Components</a>
<a class="list-group-item" href="./guide-concept-properties.html">Properties</a>
<a class="list-group-item" href="./guide-concept-events.html">Events</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Behaviors</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Configurations</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Aliases</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Class Autoloading</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-556" data-toggle="collapse" data-parent="#navigation">Working with Databases <b class="caret"></b></a><div id="navigation-556" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Database Access Objects</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Query Builder</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Migrations</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-sphinx/doc/guide">Sphinx</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-redis/doc/guide">Redis</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-mongodb/doc/guide">MongoDB</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-elasticsearch/doc/guide">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-557" data-toggle="collapse" data-parent="#navigation">Getting Data from Users <b class="caret"></b></a><div id="navigation-557" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Creating Forms</a>
<a class="list-group-item" href="./guide-input-validation.html">Validating Input</a>
<a class="list-group-item" href="./guide-input-file-upload.html">Uploading Files</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Collecting Tabular Input</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Getting Data for Multiple Models</a>
<a class="list-group-item" href="./guide-input-form-javascript.html">Extending ActiveForm on the Client Side</a></div>
<a class="list-group-item" href="#navigation-558" data-toggle="collapse" data-parent="#navigation">Displaying Data <b class="caret"></b></a><div id="navigation-558" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">Data Formatting</a>
<a class="list-group-item" href="./guide-output-pagination.html">Pagination</a>
<a class="list-group-item" href="./guide-output-sorting.html">Sorting</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Data Providers</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Data Widgets</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">Working with Client Scripts</a>
<a class="list-group-item" href="./guide-output-theming.html">Theming</a></div>
<a class="list-group-item active" href="#navigation-559" data-toggle="collapse" data-parent="#navigation">Security <b class="caret"></b></a><div id="navigation-559" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-security-overview.html">Security Overview</a>
<a class="list-group-item" href="./guide-security-authentication.html">Authentication</a>
<a class="list-group-item" href="./guide-security-authorization.html">Authorization</a>
<a class="list-group-item" href="./guide-security-passwords.html">Working with Passwords</a>
<a class="list-group-item" href="./guide-security-cryptography.html">Cryptography</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-authclient/doc/guide">Auth Clients</a>
<a class="list-group-item active" href="./guide-security-best-practices.html">Best Practices</a></div>
<a class="list-group-item" href="#navigation-560" data-toggle="collapse" data-parent="#navigation">Caching <b class="caret"></b></a><div id="navigation-560" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Caching Overview</a>
<a class="list-group-item" href="./guide-caching-data.html">Data Caching</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Fragment Caching</a>
<a class="list-group-item" href="./guide-caching-page.html">Page Caching</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP Caching</a></div>
<a class="list-group-item" href="#navigation-561" data-toggle="collapse" data-parent="#navigation">RESTful Web Services <b class="caret"></b></a><div id="navigation-561" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Quick Start</a>
<a class="list-group-item" href="./guide-rest-resources.html">Resources</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Controllers</a>
<a class="list-group-item" href="./guide-rest-routing.html">Routing</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Response Formatting</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Authentication</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Rate Limiting</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Versioning</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Error Handling</a></div>
<a class="list-group-item" href="#navigation-562" data-toggle="collapse" data-parent="#navigation">Development Tools <b class="caret"></b></a><div id="navigation-562" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-debug/doc/guide">Debug Toolbar and Debugger</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-gii/doc/guide">Generating Code using Gii</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-apidoc">Generating API Documentation</a></div>
<a class="list-group-item" href="#navigation-563" data-toggle="collapse" data-parent="#navigation">Testing <b class="caret"></b></a><div id="navigation-563" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Testing Overview</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Testing environment setup</a>
<a class="list-group-item" href="./guide-test-unit.html">Unit Tests</a>
<a class="list-group-item" href="./guide-test-functional.html">Functional Tests</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Acceptance Tests</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Fixtures</a></div>
<a class="list-group-item" href="#navigation-564" data-toggle="collapse" data-parent="#navigation">Special Topics <b class="caret"></b></a><div id="navigation-564" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-app-advanced/doc/guide">Advanced Project Template</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Building Application from Scratch</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Console Commands</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Core Validators</a>
<a class="list-group-item" href="./guide-tutorial-docker.html">Docker</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Internationalization</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Mailing</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Performance Tuning</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Shared Hosting Environment</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Template Engines</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Working with Third-Party Code</a>
<a class="list-group-item" href="./guide-tutorial-yii-as-micro-framework.html">Using Yii as a micro framework</a></div>
<a class="list-group-item" href="#navigation-565" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-565" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-listview.html">ListView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-detailview.html">DetailView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/guide-input-forms.html#activerecord-based-forms-activeform">ActiveForm</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">Pjax</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-menu.html">Menu</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-linkpager.html">LinkPager</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-linksorter.html">LinkSorter</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-bootstrap/doc/guide">Bootstrap Widgets</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-jui/doc/guide">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-566" data-toggle="collapse" data-parent="#navigation">Helpers <b class="caret"></b></a><div id="navigation-566" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Helpers Overview</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Security best practices <span id="security-best-practices"></span><a href="#security-best-practices" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#basic-principles">Basic principles</a></li>
<li><a href="#avoiding-sql-injections">Avoiding SQL injections</a></li>
<li><a href="#avoiding-xss">Avoiding XSS</a></li>
<li><a href="#avoiding-csrf">Avoiding CSRF</a></li>
<li><a href="#avoiding-file-exposure">Avoiding file exposure</a></li>
<li><a href="#avoiding-debug-info-and-tools-in-production">Avoiding debug info and tools in production</a></li>
<li><a href="#using-secure-connection-over-tls">Using secure connection over TLS</a></li>
<li><a href="#secure-server-configuration">Secure Server configuration</a></li></ol></div>
<p>Below we'll review common security principles and describe how to avoid threats when developing applications using Yii.
Most of these principles are not unique to Yii alone but apply to website or software development in general,
so you will also find links for further reading on the general ideas behind these.</p>
<h2>Basic principles <span id="basic-principles"></span><a href="#basic-principles" class="hashlink">&para;</a></h2><p>There are two main principles when it comes to security no matter which application is being developed:</p>
<ol>
<li>Filter input.</li>
<li>Escape output.</li>
</ol>
<h3>Filter input <span id="filter-input"></span><a href="#filter-input" class="hashlink">&para;</a></h3><p>Filter input means that input should never be considered safe and you should always check if the value you've got is
actually among allowed ones. For example, if we know that sorting could be done by three fields <code>title</code>, <code>created_at</code> and <code>status</code>
and the field could be supplied via user input, it's better to check the value we've got right where we're receiving it.
In terms of basic PHP that would look like the following:</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$sortBy</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'sort'</span>];
<span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$sortBy</span>, [<span class="hljs-string">'title'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'status'</span>])) {
	<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">'Invalid sort value.'</span>);
}
</code></pre>
<p>In Yii, most probably you'll use <a href="guide-input-validation.html">form validation</a> to do alike checks.</p>
<p>Further reading on the topic:</p>
<ul>
<li><a href="https://www.owasp.org/index.php/Data_Validation">https://www.owasp.org/index.php/Data_Validation</a></li>
<li><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet</a></li>
</ul>
<h3>Escape output <span id="escape-output"></span><a href="#escape-output" class="hashlink">&para;</a></h3><p>Escape output means that depending on context where we're using data it should be escaped i.e. in context of HTML you
should escape <code>&lt;</code>, <code>&gt;</code> and alike special characters. In context of JavaScript or SQL it will be different set of characters.
Since it's error-prone to escape everything manually Yii provides various tools to perform escaping for different
contexts.</p>
<p>Further reading on the topic:</p>
<ul>
<li><a href="https://www.owasp.org/index.php/Command_Injection">https://www.owasp.org/index.php/Command_Injection</a></li>
<li><a href="https://www.owasp.org/index.php/Code_Injection">https://www.owasp.org/index.php/Code_Injection</a></li>
<li><a href="https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29">https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)</a></li>
</ul>
<h2>Avoiding SQL injections <span id="avoiding-sql-injections"></span><a href="#avoiding-sql-injections" class="hashlink">&para;</a></h2><p>SQL injection happens when query text is formed by concatenating unescaped strings such as the following:</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'username'</span>];
<span class="hljs-variable">$sql</span> = <span class="hljs-string">"SELECT * FROM user WHERE username = '$username'"</span>;
</code></pre>
<p>Instead of supplying correct username attacker could give your applications something like <code>'; DROP TABLE user; --</code>.
Resulting SQL will be the following:</p>
<pre><code class="hljs sql language-sql"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> username = <span class="hljs-string">''</span>;</span> <span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span>;</span> <span class="hljs-comment">--'</span>
</code></pre>
<p>This is valid query that will search for users with empty username and then will drop <code>user</code> table most probably
resulting in broken website and data loss (you've set up regular backups, right?).</p>
<p>In Yii most of database querying happens via <a href="guide-db-active-record.html">Active Record</a> which properly uses PDO prepared
statements internally. In case of prepared statements it's not possible to manipulate query as was demonstrated above.</p>
<p>Still, sometimes you need <a href="guide-db-dao.html">raw queries</a> or <a href="guide-db-query-builder.html">query builder</a>. In this case you should use
safe ways of passing data. If data is used for column values it's preferred to use prepared statements:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// query builder</span>
<span class="hljs-variable">$userIDs</span> = (<span class="hljs-keyword">new</span> Query())
    -&gt;select(<span class="hljs-string">'id'</span>)
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;where(<span class="hljs-string">'status=:status'</span>, [<span class="hljs-string">':status'</span> =&gt; <span class="hljs-variable">$status</span>])
    -&gt;all();

<span class="hljs-comment">// DAO</span>
<span class="hljs-variable">$userIDs</span> = <span class="hljs-variable">$connection</span>
    -&gt;createCommand(<span class="hljs-string">'SELECT id FROM user where status=:status'</span>)
    -&gt;bindValues([<span class="hljs-string">':status'</span> =&gt; <span class="hljs-variable">$status</span>])
    -&gt;queryColumn();
</code></pre>
<p>If data is used to specify column names or table names the best thing to do is to allow only predefined set of values:</p>
<pre><code class="hljs php language-php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionList</span><span class="hljs-params">(<span class="hljs-variable">$orderBy</span> = null)</span>
</span>{
    <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$orderBy</span>, [<span class="hljs-string">'name'</span>, <span class="hljs-string">'status'</span>])) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadRequestHttpException(<span class="hljs-string">'Only name and status are allowed to order by.'</span>)
    }
    
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>In case it's not possible, table and column names should be escaped. Yii has special syntax for such escaping
which allows doing it the same way for all databases it supports:</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">"SELECT COUNT([[$column]]) FROM {{table}}"</span>;
<span class="hljs-variable">$rowCount</span> = <span class="hljs-variable">$connection</span>-&gt;createCommand(<span class="hljs-variable">$sql</span>)-&gt;queryScalar();
</code></pre>
<p>You can get details about the syntax in <a href="guide-db-dao.html#quoting-table-and-column-names">Quoting Table and Column Names</a>.</p>
<p>Further reading on the topic:</p>
<ul>
<li><a href="https://www.owasp.org/index.php/SQL_Injection">https://www.owasp.org/index.php/SQL_Injection</a></li>
</ul>
<h2>Avoiding XSS <span id="avoiding-xss"></span><a href="#avoiding-xss" class="hashlink">&para;</a></h2><p>XSS or cross-site scripting happens when output isn't escaped properly when outputting HTML to the browser. For example,
if user can enter his name and instead of <code>Alexander</code> he enters <code>&lt;script&gt;alert('Hello!');&lt;/script&gt;</code>, every page that
outputs user name without escaping it will execute JavaScript <code>alert('Hello!');</code> resulting in alert box popping up
in a browser. Depending on website instead of innocent alert such script could send messages using your name or even
perform bank transactions.</p>
<p>Avoiding XSS is quite easy in Yii. There are generally two cases:</p>
<ol>
<li>You want data to be outputted as plain text.</li>
<li>You want data to be outputted as HTML.</li>
</ol>
<p>If all you need is plain text then escaping is as easy as the following:</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?</span>= \yii\helpers\Html::encode(<span class="hljs-variable">$username</span>) <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>If it should be HTML we could get some help from HtmlPurifier:</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?</span>= \yii\helpers\HtmlPurifier::process(<span class="hljs-variable">$description</span>) <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>Note that HtmlPurifier processing is quite heavy so consider adding caching.</p>
<p>Further reading on the topic:</p>
<ul>
<li><a href="https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29">https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)</a></li>
</ul>
<h2>Avoiding CSRF <span id="avoiding-csrf"></span><a href="#avoiding-csrf" class="hashlink">&para;</a></h2><p>CSRF is an abbreviation for cross-site request forgery. The idea is that many applications assume that requests coming
from a user browser are made by the user themselves. This assumption could be false.</p>
<p>For example, the website <code>an.example.com</code> has a <code>/logout</code> URL that, when accessed using a simple GET request, logs the user out. As long
as it's requested by the user themselves everything is OK, but one day bad guys are somehow posting
<code>&lt;img src="http://an.example.com/logout"&gt;</code> on a forum the user visits frequently. The browser doesn't make any difference between
requesting an image or requesting a page so when the user opens a page with such a manipulated <code>&lt;img&gt;</code> tag,
the browser will send the GET request to that URL and the user will be logged out from <code>an.example.com</code>.</p>
<p>That's the basic idea of how a CSRF attack works. One can say that logging out a user is not a serious thing,
however this was just an example, there are much more things one could do using this approach, for example triggering payments
or changing data. Imagine that some website has an URL
<code>http://an.example.com/purse/transfer?to=anotherUser&amp;amount=2000</code>. Accessing it using GET request, causes transfer of $2000
from authorized user account to user <code>anotherUser</code>. We know, that the browser will always send GET request to load an image,
so we can modify code to accept only POST requests on that URL. Unfortunately, this will not save us, because an attacker
can put some JavaScript code instead of <code>&lt;img&gt;</code> tag, which allows to send POST requests to that URL as well.</p>
<p>For this reason, Yii applies additional mechanisms to protect against CSRF attacks.</p>
<p>In order to avoid CSRF you should always:</p>
<ol>
<li>Follow HTTP specification i.e. GET should not change application state.
See <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">RFC2616</a> for more details.</li>
<li>Keep Yii CSRF protection enabled.</li>
</ol>
<p>Sometimes you need to disable CSRF validation per controller and/or action. It could be achieved by setting its property:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$enableCsrfValidation</span> = <span class="hljs-keyword">false</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionIndex</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// CSRF validation will not be applied to this and other actions</span>
    }

}
</code></pre>
<p>To disable CSRF validation per custom actions you can do:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beforeAction</span><span class="hljs-params">(<span class="hljs-variable">$action</span>)</span>
    </span>{
        <span class="hljs-comment">// ...set `$this-&gt;enableCsrfValidation` here based on some conditions...</span>
        <span class="hljs-comment">// call parent method that will check CSRF if such property is `true`.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">parent</span>::beforeAction(<span class="hljs-variable">$action</span>);
    }
}
</code></pre>
<p>Disabling CSRF validation in <a href="guide-structure-controllers.html#standalone-actions">standalone actions</a> must be done in <code>init()</code>
method. Do not place this code into <code>beforeRun()</code> method because it won't have effect.</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">components</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">base</span>\<span class="hljs-title">Action</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContactAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Action</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">parent</span>::init();
        <span class="hljs-variable">$this</span>-&gt;controller-&gt;enableCsrfValidation = <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span><span class="hljs-params">()</span>
    </span>{
          <span class="hljs-variable">$model</span> = <span class="hljs-keyword">new</span> ContactForm();
          <span class="hljs-variable">$request</span> = Yii::<span class="hljs-variable">$app</span>-&gt;request;
          <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;referrer === <span class="hljs-string">'yiipowered.com'</span>
              &amp;&amp; <span class="hljs-variable">$model</span>-&gt;load(<span class="hljs-variable">$request</span>-&gt;post())
              &amp;&amp; <span class="hljs-variable">$model</span>-&gt;validate()
          ) {
              <span class="hljs-variable">$model</span>-&gt;sendEmail();
          }
    }
}
</code></pre>
<blockquote class="warning"><p><strong>Warning: </strong>Disabling CSRF will allow any site to send POST requests to your site. It is important to implement extra validation such as checking an IP address or a secret token in this case.</p>
</blockquote>
<p>Further reading on the topic:</p>
<ul>
<li><a href="https://www.owasp.org/index.php/CSRF">https://www.owasp.org/index.php/CSRF</a></li>
</ul>
<h2>Avoiding file exposure <span id="avoiding-file-exposure"></span><a href="#avoiding-file-exposure" class="hashlink">&para;</a></h2><p>By default server webroot is meant to be pointed to <code>web</code> directory where <code>index.php</code> is. In case of shared hosting
environments it could be impossible to achieve so we'll end up with all the code, configs and logs in server webroot.</p>
<p>If it's the case don't forget to deny access to everything except <code>web</code>. If it can't be done consider hosting your
application elsewhere.</p>
<h2>Avoiding debug info and tools in production <span id="avoiding-debug-info-and-tools-in-production"></span><a href="#avoiding-debug-info-and-tools-in-production" class="hashlink">&para;</a></h2><p>In debug mode Yii shows quite verbose errors which are certainly helpful for development. The thing is that these
verbose errors are handy for attacker as well since these could reveal database structure, configuration values and
parts of your code. Never run production applications with <code>YII_DEBUG</code> set to <code>true</code> in your <code>index.php</code>.</p>
<p>You should never enable Gii or the Debug toolbar in production. It could be used to get information about database structure, code and to
simply rewrite code with what's generated by Gii.</p>
<p>Debug toolbar should be avoided at production unless really necessary. It exposes all the application and config
details possible. If you absolutely need it check twice that access is properly restricted to your IP only.</p>
<p>Further reading on the topic:</p>
<ul>
<li><a href="https://www.owasp.org/index.php/Exception_Handling">https://www.owasp.org/index.php/Exception_Handling</a></li>
<li><a href="https://www.owasp.org/index.php/Top_10_2007-Information_Leakage">https://www.owasp.org/index.php/Top_10_2007-Information_Leakage</a></li>
</ul>
<h2>Using secure connection over TLS <span id="using-secure-connection-over-tls"></span><a href="#using-secure-connection-over-tls" class="hashlink">&para;</a></h2><p>Yii provides features that rely on cookies and/or PHP sessions. These can be vulnerable in case your connection is
compromised. The risk is reduced if the app uses secure connection via TLS (often referred to as <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">SSL</a>).</p>
<p>Please refer to your webserver documentation for instructions on how to configure it. You may also check example configs
provided by the H5BP project:</p>
<ul>
<li><a href="https://github.com/h5bp/server-configs-nginx">Nginx</a></li>
<li><a href="https://github.com/h5bp/server-configs-apache">Apache</a>.</li>
<li><a href="https://github.com/h5bp/server-configs-iis">IIS</a>.</li>
<li><a href="https://github.com/h5bp/server-configs-lighttpd">Lighttpd</a>.</li>
</ul>
<h2>Secure Server configuration <span id="secure-server-configuration"></span><a href="#secure-server-configuration" class="hashlink">&para;</a></h2><p>The purpose of this section is to highlight risks that need to be considered when creating a
server configuration for serving a Yii based website. Besides the points covered here there may
be other security related configuration options to be considered, so do not consider this section to
be complete.</p>
<h3>Avoiding <code>Host</code>-header attacks <span id="avoiding-host-header-attacks"></span><a href="#avoiding-host-header-attacks" class="hashlink">&para;</a></h3><p>Classes like <a href="./yii-web-urlmanager.html">yii\web\UrlManager</a> and <a href="./yii-helpers-url.html">yii\helpers\Url</a> may use the <a href="./yii-web-request.html#getHostInfo()-detail">currently requested host name</a>
for generating links.
If the webserver is configured to serve the same site independent of the value of the <code>Host</code> header, this information may not be reliable
and <a href="https://www.acunetix.com/vulnerabilities/web/host-header-attack">may be faked by the user sending the HTTP request</a>.
In such situations you should either fix your webserver configuration to serve the site only for specified host names
or explicitly set or filter the value by setting the <a href="./yii-web-request.html#setHostInfo()-detail">hostInfo</a> property of the <code>request</code> application component.</p>
<p>For more information about the server configuration, please refer to the documentation of your webserver:</p>
<ul>
<li>Apache 2: <a href="http://httpd.apache.org/docs/trunk/vhosts/examples.html#defaultallports">http://httpd.apache.org/docs/trunk/vhosts/examples.html#defaultallports</a></li>
<li>Nginx: <a href="https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/">https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/</a></li>
</ul>
<p>If you don't have access to the server configuration, you can setup <a href="./yii-filters-hostcontrol.html">yii\filters\HostControl</a> filter at
application level in order to protect against such kind of attack:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// Web Application configuration file</span>
<span class="hljs-keyword">return</span> [
    <span class="hljs-string">'as hostControl'</span> =&gt; [
        <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\filters\HostControl'</span>,
        <span class="hljs-string">'allowedHosts'</span> =&gt; [
            <span class="hljs-string">'example.com'</span>,
            <span class="hljs-string">'*.example.com'</span>,
        ],
        <span class="hljs-string">'fallbackHostInfo'</span> =&gt; <span class="hljs-string">'https://example.com'</span>,
    ],
    <span class="hljs-comment">// ...</span>
];
</code></pre>
<blockquote class="note"><p><strong>Note: </strong>you should always prefer web server configuration for 'host header attack' protection instead of the filter usage.
  <a href="./yii-filters-hostcontrol.html">yii\filters\HostControl</a> should be used only if server configuration setup is unavailable.</p>
</blockquote>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Wed, 10 Apr 2019 23:20:39 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
